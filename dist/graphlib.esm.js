import{has as e,isFunction as t,constant as r,keys as i,filter as n,isEmpty as s,each as o,isUndefined as h,union as d,values as a,reduce as u,transform as c,size as _,isArray as f,map as l,clone as p}from"lodash";class v{constructor(t={}){this._nodes={},this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={},this._nodeCount=0,this._edgeCount=0,this._isDirected=!e(t,"directed")||t.directed,this._isMultigraph=!!e(t,"multigraph")&&t.multigraph,this._isCompound=!!e(t,"compound")&&t.compound,this._isCompound&&(this._parent={},this._children={},this._children["\0"]={})}isDirected(){return this._isDirected}isMultigraph(){return this._isMultigraph}isCompound(){return this._isCompound}setGraph(e){return this._label=e,this}graph(){return this._label}setDefaultNodeLabel(e){return t(e)||(e=r(e)),this._defaultNodeLabelFn=e,this}nodeCount(){return this._nodeCount}nodes(){return i(this._nodes)}sources(){var e=this;return n(this.nodes(),(function(t){return s(e._in[t])}))}sinks(){var e=this;return n(this.nodes(),(function(t){return s(e._out[t])}))}setNodes(e,t){var r=arguments,i=this;return o(e,(function(e){r.length>1?i.setNode(e,t):i.setNode(e)})),this}setNode(t,r){if(e(this._nodes,t))return arguments.length>1&&(this._nodes[t]=r),this;let i=this._defaultNodeLabelFn||function(e){return e};return this._nodes[t]=arguments.length>1?r:i(t),this._isCompound&&(this._parent[t]="\0",this._children[t]={},this._children["\0"][t]=!0),this._in[t]={},this._preds[t]={},this._out[t]={},this._sucs[t]={},++this._nodeCount,this}node(e){return this._nodes[e]}hasNode(t){return e(this._nodes,t)}removeNode(t){var r=this;if(e(this._nodes,t)){var n=function(e){r.removeEdge(r._edgeObjs[e])};delete this._nodes[t],this._isCompound&&(this._removeFromParentsChildList(t),delete this._parent[t],o(this.children(t),(function(e){r.setParent(e)})),delete this._children[t]),o(i(this._in[t]),n),delete this._in[t],delete this._preds[t],o(i(this._out[t]),n),delete this._out[t],delete this._sucs[t],--this._nodeCount}return this}setParent(e,t){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(h(t))t="\0";else{for(var r=t+="";!h(r);r=this.parent(r))if(r===e)throw new Error("Setting "+t+" as parent of "+e+" would create a cycle");this.setNode(t)}return this.setNode(e),this._removeFromParentsChildList(e),this._parent[e]=t,this._children[t][e]=!0,this}_removeFromParentsChildList(e){delete this._children[this._parent[e]][e]}parent(e){if(this._isCompound){var t=this._parent[e];if("\0"!==t)return t}}children(e){if(h(e)&&(e="\0"),this._isCompound){var t=this._children[e];if(t)return i(t)}else{if("\0"===e)return this.nodes();if(this.hasNode(e))return[]}return[]}predecessors(e){var t=this._preds[e];return t?i(t):[]}successors(e){var t=this._sucs[e];return t?i(t):[]}neighbors(e){var t=this.predecessors(e);if(t)return d(t,this.successors(e))}isLeaf(e){return 0===(this.isDirected()?this.successors(e):this.neighbors(e)).length}filterNodes(e){var t=new v({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});t.setGraph(this.graph());var r=this;o(this._nodes,(function(r,i){e(i)&&t.setNode(i,r)})),o(this._edgeObjs,(function(e){t.hasNode(e.v)&&t.hasNode(e.w)&&t.setEdge(e,r.edge(e))}));var i={};function n(e){var s=r.parent(e);return void 0===s||t.hasNode(s)?(i[e]=s,s):s in i?i[s]:n(s)}return this._isCompound&&o(t.nodes(),(function(e){t.setParent(e,n(e))})),t}setDefaultEdgeLabel(e){return t(e)||(e=r(e)),this._defaultEdgeLabelFn=e,this}edgeCount(){return this._edgeCount}edges(){return a(this._edgeObjs)}setPath(e,t){var r=this,i=arguments;return u(e,(function(e,n){return i.length>1?r.setEdge(e,n,t):r.setEdge(e,n),n})),this}setEdge(t,r,i,n){var s,o,d,a,u=!1,c=arguments[0];"object"==typeof c&&null!==c&&"v"in c?(s=c.v,o=c.w,d=c.name,2===arguments.length&&(a=arguments[1],u=!0)):(s=c,o=arguments[1],d=arguments[3],arguments.length>2&&(a=arguments[2],u=!0)),s=""+s,o=""+o,h(d)||(d=""+d);var _=m(this._isDirected,s,o,d);if(e(this._edgeLabels,_))return u&&(this._edgeLabels[_]=a),this;if(!h(d)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(s),this.setNode(o),this._edgeLabels[_]=u?a:this._defaultEdgeLabelFn(s,o,d);var f=function(e,t,r,i){var n=""+t,s=""+r;if(!e&&n>s){var o=n;n=s,s=o}var h={v:n,w:s};i&&(h.name=i);return h}(this._isDirected,s,o,d);return s=f.v,o=f.w,Object.freeze(f),this._edgeObjs[_]=f,g(this._preds[o],s),g(this._sucs[s],o),this._in[o][_]=f,this._out[s][_]=f,this._edgeCount++,this}edge(e,t,r){var i=1===arguments.length?E(this._isDirected,arguments[0]):m(this._isDirected,e,t,r);return this._edgeLabels[i]}hasEdge(t,r,i){var n=1===arguments.length?E(this._isDirected,arguments[0]):m(this._isDirected,t,r,i);return e(this._edgeLabels,n)}removeEdge(e,t,r){var i=1===arguments.length?E(this._isDirected,arguments[0]):m(this._isDirected,e,t,r),n=this._edgeObjs[i];if(n){const e=n.v,t=n.w;delete this._edgeLabels[i],delete this._edgeObjs[i],w(this._preds[t],e),w(this._sucs[e],t),delete this._in[t][i],delete this._out[e][i],this._edgeCount--}return this}inEdges(e,t){var r=this._in[e];if(r){var i=a(r);return t?n(i,(function(e){return e.v===t})):i}}outEdges(e,t){var r=this._out[e];if(r){var i=a(r);return t?n(i,(function(e){return e.w===t})):i}}nodeEdges(e,t){var r=this.inEdges(e,t);if(r)return r.concat(this.outEdges(e,t))}}function g(e,t){e[t]?e[t]++:e[t]=1}function w(e,t){--e[t]||delete e[t]}function m(e,t,r,i){var n=""+t,s=""+r;if(!e&&n>s){var o=n;n=s,s=o}return n+""+s+""+(h(i)?"\0":i)}function E(e,t){return m(e,t.v,t.w,t.name)}var y={Graph:v};class N{constructor(){this._arr=[],this._keyIndices={}}size(){return this._arr.length}keys(){return this._arr.map((function(e){return e.key}))}has(t){return e(this._keyIndices,t)}priority(e){var t=this._keyIndices[e];if(void 0!==t)return this._arr[t].priority}min(){if(0===this.size())throw new Error("Queue underflow");return this._arr[0].key}add(t,r){var i=this._keyIndices;if(t=String(t),!e(i,t)){var n=this._arr,s=n.length;return i[t]=s,n.push({key:t,priority:r}),this._decrease(s),!0}return!1}removeMin(){this._swap(0,this._arr.length-1);var e=this._arr.pop();return delete this._keyIndices[e.key],this._heapify(0),e.key}decrease(e,t){var r=this._keyIndices[e];if(t>this._arr[r].priority)throw new Error("New priority is greater than current priority. Key: "+e+" Old: "+this._arr[r].priority+" New: "+t);this._arr[r].priority=t,this._decrease(r)}_heapify(e){var t=this._arr,r=2*e,i=r+1,n=e;r<t.length&&(n=t[r].priority<t[n].priority?r:n,i<t.length&&(n=t[i].priority<t[n].priority?i:n),n!==e&&(this._swap(e,n),this._heapify(n)))}_decrease(e){for(var t,r=this._arr,i=r[e].priority;0!==e&&!(r[t=e>>1].priority<i);)this._swap(e,t),e=t}_swap(e,t){var r=this._arr,i=this._keyIndices,n=r[e],s=r[t];r[e]=s,r[t]=n,i[s.key]=e,i[n.key]=t}}var b=r(1);function C(e,t,r,i){return function(e,t,r,i){var n,s,o={},h=new N,d=function(e){var t=e.v!==n?e.v:e.w,i=o[t],d=r(e),a=s.distance+d;if(d<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+e+" Weight: "+d);a<i.distance&&(i.distance=a,i.predecessor=n,h.decrease(t,a))};e.nodes().forEach((function(e){var r=e===t?0:Number.POSITIVE_INFINITY;o[e]={distance:r},h.add(e,r)}));for(;h.size()>0&&(n=h.removeMin(),(s=o[n]).distance!==Number.POSITIVE_INFINITY);)i(n).forEach(d);return o}(e,String(t),r||b,i||function(t){return e.outEdges(t)})}function k(t){var r=0,i=[],n={},s=[];function o(h){var d=n[h]={onStack:!0,lowlink:r,index:r++};if(i.push(h),t.successors(h).forEach((function(t){e(n,t)?n[t].onStack&&(d.lowlink=Math.min(d.lowlink,n[t].index)):(o(t),d.lowlink=Math.min(d.lowlink,n[t].lowlink))})),d.lowlink===d.index){var a,u=[];do{a=i.pop(),n[a].onStack=!1,u.push(a)}while(h!==a);s.push(u)}}return t.nodes().forEach((function(t){e(n,t)||o(t)})),s}var I=r(1);function D(t){var r={},i={},n=[];if(o(t.sinks(),(function s(h){if(e(i,h))throw new L;e(r,h)||(i[h]=!0,r[h]=!0,o(t.predecessors(h),s),delete i[h],n.push(h))})),_(r)!==t.nodeCount())throw new L;return n}function L(){}function j(e,t,r){f(t)||(t=[t]);var i=(e.isDirected()?e.successors:e.neighbors).bind(e),n=[],s={};return o(t,(function(t){if(!e.hasNode(t))throw new Error("Graph does not have node: "+t);O(e,t,"post"===r,s,i,n)})),n}function O(t,r,i,n,s,h){e(n,r)||(n[r]=!0,i||h.push(r),o(s(r),(function(e){O(t,e,i,n,s,h)})),i&&h.push(r))}D.CycleException=L,L.prototype=new Error;var M={components:function(t){var r,i={},n=[];function s(n){e(i,n)||(i[n]=!0,r.push(n),o(t.successors(n),s),o(t.predecessors(n),s))}return o(t.nodes(),(function(e){r=[],s(e),r.length&&n.push(r)})),n},dijkstra:C,dijkstraAll:function(e,t,r){return c(e.nodes(),(function(i,n){i[n]=C(e,n,t,r)}),{})},findCycles:function(e){return n(k(e),(function(t){return t.length>1||1===t.length&&e.hasEdge(t[0],t[0])}))},isAcyclic:function(e){try{D(e)}catch(e){if(e instanceof D.CycleException)return!1;throw e}return!0},floydWarshall:function(e,t,r){return function(e,t,r){var i={},n=e.nodes();return n.forEach((function(e){i[e]={},i[e][e]={distance:0},n.forEach((function(t){e!==t&&(i[e][t]={distance:Number.POSITIVE_INFINITY})})),r(e).forEach((function(r){var n=r.v===e?r.w:r.v,s=t(r);i[e][n]={distance:s,predecessor:e}}))})),n.forEach((function(e){var t=i[e];n.forEach((function(r){var s=i[r];n.forEach((function(r){var i=s[e],n=t[r],o=s[r],h=i.distance+n.distance;h<o.distance&&(o.distance=h,o.predecessor=n.predecessor)}))}))})),i}(e,t||I,r||function(t){return e.outEdges(t)})},postorder:function(e,t){return j(e,t,"post")},preorder:function(e,t){return j(e,t,"pre")},prim:function(t,r){var i,n=new v,s={},h=new N;function d(e){var t=e.v===i?e.w:e.v,n=h.priority(t);if(void 0!==n){var o=r(e);o<n&&(s[t]=i,h.decrease(t,o))}}if(0===t.nodeCount())return n;o(t.nodes(),(function(e){h.add(e,Number.POSITIVE_INFINITY),n.setNode(e)})),h.decrease(t.nodes()[0],0);for(var a=!1;h.size()>0;){if(i=h.removeMin(),e(s,i))n.setEdge(i,s[i]);else{if(a)throw new Error("Input graph is not connected: "+t);a=!0}t.nodeEdges(i).forEach(d)}return n},tarjan:k,topsort:D};function P(e){return l(e.nodes(),(function(t){var r=e.node(t),i=e.parent(t),n={v:t};return h(r)||(n.value=r),h(i)||(n.parent=i),n}))}function F(e){return l(e.edges(),(function(t){var r=e.edge(t),i={v:t.v,w:t.w};return h(t.name)||(i.name=t.name),h(r)||(i.value=r),i}))}var S={Graph:y.Graph,json:{read:function(e){var t=new v(e.options).setGraph(e.value);return o(e.nodes,(function(e){t.setNode(e.v,e.value),e.parent&&t.setParent(e.v,e.parent)})),o(e.edges,(function(e){t.setEdge({v:e.v,w:e.w,name:e.name},e.value)})),t},write:function(e){var t={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:P(e),edges:F(e)};return h(e.graph())||(t.value=p(e.graph())),t}},alg:M,version:y.version};export default S;
